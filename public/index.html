<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>HistÃ³rico de AÃ§Ãµes LeChef</title>
    <style>
        body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
        .log-entry { border-bottom: 1px solid #333; padding: 10px; margin-bottom: 10px; }
        .time { color: #888; }
        .payload { color: #fff; background: #222; padding: 5px; display: block; margin-top: 5px; white-space: pre-wrap; word-break: break-all; }
        .tag { background: #005500; color: #0f0; padding: 2px 5px; border-radius: 3px; font-size: 0.8em; }
    </style>
</head>
<body>
    <h2>ðŸ“¡ Log de AÃ§Ãµes em Tempo Real (Interceptador)</h2>
    <div id="lista">Aguardando aÃ§Ãµes...</div>

    <script>
        async function carregar() {
            const res = await fetch('/api/historico');
            const dados = await res.json();
            const lista = document.getElementById('lista');

            if(dados.length === 0) {
                lista.innerHTML = "Nenhuma aÃ§Ã£o interceptada ainda.";
                return;
            }

            lista.innerHTML = dados.map(log => `
                <div class="log-entry">
                    <span class="time">[${log.data}]</span> 
                    <span class="tag">POST -> ${log.detalhes.url_original.split('/').pop()}</span>
                    <div class="payload"><b>DADOS ENVIADOS:</b><br>${log.detalhes.payload}</div>
                    <div style="color: #444; font-size: 0.8em;">Resposta do Servidor: ${log.detalhes.resposta.substring(0, 100)}...</div>
                </div>
            `).join('');
        }

        setInterval(carregar, 5000);
        carregar();
    </script>
</body>
</html>